
#include <avr/io.h>
#include <avr/interrupt.h>
#include <util/delay.h>

volatile uint8_t buttonPressed = 0;

int main() {
    // ??????? ??? INT1 (PD3) ?? ??????? ?? ???????????? ????????? pull-up
    DDRD &= ~(1 << 3);
    PORTD |= (1 << 3);
  
    // ??????? ??? INT1 ??? ?????????? ??????
    EICRA = (1 << ISC10) | (1 << ISC11);
  
    // ???????????? ??? INT1
    EIMSK |= (1 << INT1);
  
    // ???????????? ??? global interrupts
    sei();
    
    // ??????? ??? PB0-PB7 ?? ??????
    DDRB = 0xFF;

    while (1) {
        // ??????? ?? ?? ?????? ???? ???????
        if (buttonPressed) {
	   buttonPressed = 0;
      
            // ?????? ??? ?? LED ??? 0.5 sec
   	   PORTB = 0xFF;
	   for (int i=0; i<500; i++) {
		_delay_ms(16);
		if(buttonPressed) break;
	}
	   if(buttonPressed) continue;
  
    	   // ?????? ??? ?? LED ????? ??? ?? PB0 ??? 3.5 sec
    	   PORTB = 0x01;
	   for (int i=0; i<3000; i++) {
		_delay_ms(16);
		if(buttonPressed) break;
	}
           PORTB = 0x00;
        }
    }
}
// ????????? ???????? INT1
ISR(INT1_vect) {
    // ????? ?? flag ??? ?? ?????? ??? ????????
    buttonPressed = 1;
}

